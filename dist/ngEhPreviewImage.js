//author: sparrow.jang
//verion: 0.0.3
(function(){var e;e=angular.module("eHanlin",[]),e.directive("ngEhPreviewImage",["$q","$timeout",function(e,t){var n,i,r,a;return n=function(t){var n,i,r;return i=e.defer(),n=$("<div></div>"),r=document.createElement("img"),n.append(r),n.css({width:"0px",height:"0px",overflow:"hidden",visibility:"hidden"}),r.onload=function(){return i.resolve({size:{width:r.width,height:r.height},img:r}),n.remove()},r.src=t,n.appendTo(document.body),i.promise},i=function(e,t,n,i){var r,a;return a=n/e,r=i/t,r>a?a:r},r=function(t,n,i){var r,a,h,d;return h=e.defer(),d=new Image,r=document.createElement("canvas"),r.width=n,r.height=i,a=r.getContext("2d"),a.drawImage(t,0,0,n,i),d.onload=function(){return h.resolve({img:d,size:{width:n,height:i}})},d.src=r.toDataURL("image/png"),h.promise},a=function(e,t,n){var a;return a=i(e.width,e.height,t,n),r(e,a*e.width,a*e.height)},{scope:{img:"="},template:'<div class="ng-eh-preview-image">\n  <canvas style="width:100%;"></canvas>\n  <i class="fa fa-repeat" ng-click="rotateRight( $event )" ng-mousedown="onPreventDefault( $event )"></i>\n</div>',link:function(e,i){var r,h,d,u,o,g,c,l;return h=null,o=i.find("canvas")[0],r=null,d=!0,g=null,u=/(ipad)|(iphone)/i.test(navigator.userAgent),c=function(e,t){var n,i,r;return o.width=r=t?t.width:e.width,o.height=n=t?t.height:e.height,i=o.getContext("2d"),i.drawImage(e,0,0,r,n)},l=function(n){var i,a,d,u,o;return r&&(t.cancel(r),r=null),i=document.createElement("canvas"),a=i.getContext("2d"),i.height=h.width,i.width=h.height,u=h.width/2,d=h.height/2,a.save(),a.translate(d,u),a.rotate(90*Math.PI/180),a.drawImage(n,-u,-d,i.height,i.width),a.restore(),o=[h.height,h.width],h.width=o[0],h.height=o[1],r=t(function(){return e.enabledUpdated=!1,e.img.data=i.toDataURL("image/png"),t(function(){return e.enabledUpdated=!0})},750),c(i)},e.$watch("img",function(){return d?(g=n(e.img.data),g.then(function(e){var t,n,i;return t=function(e){return h=h?h:e.size,c(e.img,e.size)},i=1924,u&&(i<e.size.width||i<e.size.height)?(n=a(e.img,i,i),n.then(function(e){return t(e)})):t(e)})):void 0}),angular.extend(e,{onPreventDefault:function(e){return e.preventDefault()},rotateRight:function(e){return e.preventDefault(),g.then(function(){return l(o)})}})}}}])}).call(this);
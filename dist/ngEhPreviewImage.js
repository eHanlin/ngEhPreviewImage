//author: sparrow.jang
//verion: 0.0.1
(function(){var e;e=angular.module("eHanlin",[]),e.directive("ngEhPreviewImage",["$q","$timeout",function(e,t){var n;return n=function(t){var n,i,a;return i=e.defer(),n=$("<div></div>"),a=document.createElement("img"),n.append(a),n.css({width:"0px",height:"0px",overflow:"hidden",visibility:"hidden"}),a.onload=function(){return i.resolve({size:{width:a.width,height:a.height},img:a}),n.remove()},a.src=t,n.appendTo(document.body),i.promise},{scope:{img:"="},template:'<div class="ng-eh-preview-image">\n  <canvas style="width:100%;"></canvas>\n  <i class="fa fa-repeat" ng-click="rotateRight( $event )" ng-mousedown="onPreventDefault( $event )"></i>\n</div>',link:function(e,i){var a,r,h,d,u,o,c;return r=null,d=i.find("canvas")[0],a=null,h=!0,u=null,o=function(e,t){var n,i,a;return d.width=a=t?t.width:e.width,d.height=n=t?t.height:e.height,i=d.getContext("2d"),i.drawImage(e,0,0,a,n)},c=function(n){var i,h,d,u,c;return a&&(t.cancel(a),a=null),i=document.createElement("canvas"),h=i.getContext("2d"),i.height=r.width,i.width=r.height,u=r.width/2,d=r.height/2,h.save(),h.translate(d,u),h.rotate(90*Math.PI/180),h.drawImage(n,-u,-d,i.height,i.width),h.restore(),c=[r.height,r.width],r.width=c[0],r.height=c[1],a=t(function(){return e.enabledUpdated=!1,e.img.data=i.toDataURL("image/png"),t(function(){return e.enabledUpdated=!0})},750),o(i)},e.$watch("img",function(){return h?(u=n(e.img.data),u.then(function(e){return r=r?r:e.size,o(e.img,e.size)})):void 0}),angular.extend(e,{onPreventDefault:function(e){return e.preventDefault()},rotateRight:function(e){return e.preventDefault(),u.then(function(){return c(d)})}})}}}])}).call(this);